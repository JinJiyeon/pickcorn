{% extends 'base.html' %}
{% load static %}

{% block css %}
  <link rel="stylesheet" href="{% static 'profile.css' %}">
{% endblock %}

{% block content %}

<br>
<br>
<br>
<!--í˜ì´ì§€ íƒ€ì´í‹€-->

<h1>{{ person.username|title }}'s profile</h1>
<br>
<!--íŒ”ë¡œìš° ì–¸íŒ”ë¡œìš° ë²„íŠ¼ êµ¬í˜„-->

<!-- ìê¸°ê°€ ìê¸°ëŠ” íŒ”ë¡œìš° ëª»í•¨-->
{% if request.user != person %}
  <form action="{% url 'accounts:follow' person.pk%}" method="POST">
    {% csrf_token %}
    <!--ê¸°ì¡´íŒ”ë¡œì›Œë©´ ì–¸íŒ”ê°€ëŠ¥-->
    {% if request.user in person.followers.all %}
    <button class="btn btn-secondary d-block like-btn">Unfollow</button>
    <!-- ì•„ë‹ˆë©´ íŒ”ë¡œìš°ê°€ëŠ¥-->
    {% else %}
    <button class="btn btn-success d-block like-btn">Follow</button>
    {% endif %}
  </form>
{% endif %}

<hr>
<br>
{% comment %} íŒ”ë¡œì‰, íŒ”ë¡œì›Œ ìˆ«ì {% endcomment %}

<h5>
  <b>ğŸ• follower : </b>
  <a href="{% url 'accounts:followers' person.pk %}">{{ person.followers.all|length }}</a>
</h5>

<h5>
  <b>ğŸ” following : </b>
  <a href="{% url 'accounts:followings' person.pk %}">{{ person.followings.all|length }}</a>
</h5>

<br>
<hr>

<div class="accordion" id="accordionExample">
  <!--   í”„ë¡œí•„ì˜ ìœ ì €ê°€ ì‘ì„±í•œ ëª¨ë“  ê¸€ì˜ ì œëª© -->
  <div class="accordion-item">
    <h2 class="accordion-header " id="headingOne">
      <button class="accordion-button alert-info collapsed " type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
        <span><b>{{ person.username }}</b> ë‹˜ì´ ì‘ì„±í•œ ë¦¬ë·°</span>
        <span class="badge mx-2"><b>{{ person.article_set.all|length }}</b>ê°œ</span>
        {% comment %} ğŸ‘‰ badgeë¥¼ ì‚¬ìš©í•´ì„œ ê°œìˆ˜ê°€ ëˆˆì— ì˜ ë³´ì´ê²Œ í‘œí˜„ {% endcomment %}
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <li>
        {% for article in person.article_set.all %}
          <a class="text-decoration-none text-dark" href="{% url 'movies:article_detail' article.pk %}">
          {% comment %} ğŸ‘‰ text-decoration-none : aíƒœê·¸ ì‚¬ìš© ì‹œ ì¶”ê°€ë˜ëŠ” ë°‘ì¤„ ì œê±° {% endcomment %}
            <p>{{ article.title }} ({{ article.movie.title }})</p>
          </a>
        {% endfor %}
        </li>
      </div>
    </div>
  </div>

  <!--   í”„ë¡œí•„ì˜ ìœ ì €ê°€ ì‘ì„±í•œ ëª¨ë“  ëŒ“ê¸€ì˜ ë‚´ìš© -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingTwo">
      <button class="accordion-button alert-info collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
        <span><b>{{ person.username }}</b> ë‹˜ì´ ë‚¨ê¸´ ëŒ“ê¸€</span>
        <span class="badge mx-2"><b>{{ person.comment_set.all|length }}</b>ê°œ</span>
      </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <li>
        {% for comment in person.comment_set.all %}
          <a class="text-decoration-none text-dark" href="{% url 'movies:article_detail' comment.article.pk %}">
            <p>{{ comment.content }} (ê¸€ ì œëª©: {{ comment.article.title }} / ì˜í™”: {{ comment.article.movie.title }})</p>
          </a>
        {% endfor %}
        </li>
      </div>
    </div>
  </div>

  <!-- ì¢‹ì•„ìš”í•œ ì˜í™” -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button alert-info collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
          <span><b>{{ person.username }}</b> ë‹˜ì´ ì¢‹ì•„ìš” ëˆ„ë¥¸ ì˜í™”</span>
          <span class="badge mx-2"><b>{{ person.rated_good_movies.all|length }}</b>ê°œ</span>
      </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse container" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body row justify-content-center">
        {% for movie in posts %}
          <div class="col-12 col-sm-4 col-lg-2">
            <a href="{% url 'movies:detail' movie.pk %}" class="text-decoration-none">
              <div class="card h-100">
                <img src="https://image.tmdb.org/t/p/original/{{ movie.poster_path }}" class="card-img-top" alt="movie poster">
                  <div class="badge bg-primary card-text">
                    í‰ì : {{ movie.weighted_vote|floatformat }}
                  </div>
              </div>
            </a>
          </div>

        {% endfor %}

      </div>
      {% comment %} paginationì„ í†µí•´ ì¼ì • ê°œìˆ˜ë§Œ ë³´ì—¬ì£¼ê³  ë‹¤ìŒ ê²°ê³¼ëŠ” ë’· í˜ì´ì§€ë¡œ ë³´ì—¬ì¤Œ {% endcomment %}
      <div class="d-flex justify-content-center">
        {% if posts.has_previous %}
        <a href="?page={{ posts.previous_page_number }}&like_page={{ like_posts.number }}"><button type="button" class="btn btn-warning m-3">previous</button></a>
        {% comment %} queryë¬¸ì— ë‹¤ë¥¸ paginationì˜ ì •ë³´ë„ ê°™ì´ ë„£ìŒìœ¼ë¡œì„œ ë‹¤ë¥¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ page ì •ë³´ë¥¼ ìƒì§€ ì•Šê²Œ í•¨ {% endcomment %}
        {% endif %}
        <button type="button" class="btn btn-secondary m-3">{{ posts.number }}/{{ posts.paginator.num_pages }}</button>
        {% if posts.has_next %}
        <a href="?page={{ posts.next_page_number }}&like_page={{ like_posts.number }}"><button type="button" class="btn btn-warning m-3">next</button></a>
        {% endif %}
      </div>
    </div>

    <!--  ì°œí•œ ì˜í™”ì™€ ìˆ«ì -->
    <div class="accordion-item">
      <h2 class="accordion-header" id="panelsStayOpen-headingOne">
        <button class="accordion-button collapsed alert-info" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
            <span><b>{{ person.username }}</b>'s playlist</span>
            <span class="badge mx-2"><b>{{ person.like_movies.all|length }}</b>ê°œ</span>
        </button>
      </h2>
      <div id="collapseFour" class="accordion-collapse collapse container" aria-labelledby="headingFour" data-bs-parent="#accordionExample">
      <div class="accordion-body row justify-content-center">
        {% for movie in like_posts %}
          <div class="col-12 col-sm-4 col-lg-2">
            <a href="{% url 'movies:detail' movie.pk %}" class="text-decoration-none">
              <div class="card h-100">
                <img src="https://image.tmdb.org/t/p/original/{{ movie.poster_path }}" class="card-img-top" alt="movie poster">
                <div class="badge bg-primary card-text">
                  í‰ì : {{ movie.weighted_vote|floatformat }}
                </div>
              </div> 
            </a>
          </div>
        {% endfor %}
        
        {% comment %} paginationì„ í†µí•´ ì¼ì • ê°œìˆ˜ë§Œ ë³´ì—¬ì£¼ê³  ë‹¤ìŒ ê²°ê³¼ëŠ” ë’· í˜ì´ì§€ë¡œ ë³´ì—¬ì¤Œ {% endcomment %}
        <div class="d-flex justify-content-center">
          {% if like_posts.has_previous %}
          <a href="?like_page={{ like_posts.previous_page_number }}&page={{ posts.number }}"><button type="button" class="btn btn-warning m-3">previous</button></a>
          {% comment %} queryë¬¸ì— ë‹¤ë¥¸ paginationì˜ ì •ë³´ë„ ê°™ì´ ë„£ìŒìœ¼ë¡œì„œ ë‹¤ë¥¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ page ì •ë³´ë¥¼ ìƒì§€ ì•Šê²Œ í•¨ {% endcomment %}
          {% endif %}
          <button type="button" class="btn btn-secondary m-3">{{ like_posts.number }}/{{ like_posts.paginator.num_pages }}</button>
          {% if like_posts.has_next %}
          <a href="?like_page={{ like_posts.next_page_number }}&page={{ posts.number }}"><button type="button" class="btn btn-warning m-3">next</button></a>
          {% endif %}
        </div>
      </div>
    </div> 
  </div>
</div>

{% endblock content %}

